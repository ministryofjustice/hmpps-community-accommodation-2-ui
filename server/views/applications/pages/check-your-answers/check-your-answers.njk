{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/back-link/macro.njk" import govukBackLink %}
{% from "govuk/components/button/macro.njk" import govukButton %}
{% from "../../../components/formFields/form-page-checkboxes/macro.njk" import formPageCheckboxes %}
{% from "../../../components/printButton/macro.njk" import printButtonScript, printButton %}
{% from "../../../components/applicationSummary/macro.njk" import applicationSummary %}

{% from "../../../partials/applicantDetails.njk" import applicantDetails %}
{% from "../../../partials/showErrorSummary.njk" import showErrorSummary %}

{% extends "../layout.njk" %}

{% set mainClasses = "app-container govuk-body" %}

{% block beforeContent%}
  {{ govukBackLink({
      text: "Back",
      href: paths.applications.show({ id: page.application.id })
  }) }}
{% endblock %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-width-container">

      {{ showErrorSummary(errorSummary) }}

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-three-quarters">
          <h1 class="govuk-heading-l">
            {{ page.title }}
          </h1>
          <p class="govuk-body-l">Read through this page and check that the information provided for each answer is accurate.</p>
          <p class="govuk-body-l">Alternatively, you can download a PDF version of this page.</p>

          {{ printButton('Download as a PDF') }}
        </div>
      </div>

      <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

      {{ applicationSummary(page.applicationSummary()) }}

      <hr class="govuk-section-break govuk-section-break--l govuk-section-break--visible" />

      {{ applicantDetails(page.application) }}

      {% for section in checkYourAnswersSections(page.application) %}
        <h2 class="govuk-heading-l">{{ section.title }}</h2>
        {% for task in section.tasks %}
          <div class="main-box" data-cy-check-your-answers-section="{{ task.id }}">
            <div class="box-content">
              {{
                govukSummaryList({
                      card: {
                        title: {
                          text: task.title
                        }
                    },
                  rows: task.rows
                })
              }}
            </div>
          </div>
        {% endfor %}
      {% endfor %}

      <form action="{{ paths.applications.pages.update({ id: applicationId, task: task, page: page.name }) }}?_method=PUT" method="post" class="govuk-!-margin-top-8">
        <input type="hidden" name="_csrf" value="{{ csrfToken }}"/>

        {{
          formPageCheckboxes(
            {
              fieldName: "checkYourAnswers",
              fieldset: {
                legend: {
                  text: "Confirm your answers",
                  classes: "govuk-fieldset__legend--l"
                }
              },
              items: [
                {
                  value: "confirmed",
                  text: "I confirm to the best of my knowledge, the information provided in this referral is accurate and, where required, it has been verified by all relevant prison departments."
                }
              ]
            },
            fetchContext()
          )
        }}

        <div class="govuk-button-group">
          {{ govukButton({
          text: "Save and continue",
          preventDoubleClick: true
          }) }}

          <a href="{{ paths.applications.show({ id: applicationId }) }}">Back to task list</a>
        </div>
      </form>

    </div>
  </div>
{% endblock %}

{% block extraScripts %}
  {{ printButtonScript(cspNonce) }}
{% endblock %}
